// ? карты Мифов _start
// путть к картинкам карт
const MythicCardsURL = './src/img/assets/MythicCards/';
// * ЗЕЛЕНЫЕ карты Мифов _start

const greenCards = [
  {
    id: 'green1',
    cardFace: MythicCardsURL + 'green/green1.png',
    difficulty: 'easy',
    color: 'green'
  },
  {
    id: 'green2',
    cardFace: MythicCardsURL + 'green/green2.png',
    difficulty: 'hard',
    color: 'green'
  },
  {
    id: 'green3',
    cardFace: MythicCardsURL + 'green/green3.png',
    difficulty: 'hard',
    color: 'green'
  },
  {
    id: 'green4',
    cardFace: MythicCardsURL + 'green/green4.png',
    difficulty: 'hard',
    color: 'green'
  },
  {
    id: 'green5',
    cardFace: MythicCardsURL + 'green/green5.png',
    difficulty: 'hard',
    color: 'green'
  },
  {
    id: 'green6',
    cardFace: MythicCardsURL + 'green/green6.png',
    difficulty: 'hard',
    color: 'green'
  },
  {
    id: 'green7',
    cardFace: MythicCardsURL + 'green/green7.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green8',
    cardFace: MythicCardsURL + 'green/green8.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green9',
    cardFace: MythicCardsURL + 'green/green9.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green10',
    cardFace: MythicCardsURL + 'green/green10.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green11',
    cardFace: MythicCardsURL + 'green/green11.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green12',
    cardFace: MythicCardsURL + 'green/green12.png',
    difficulty: 'easy',
    color: 'green'
  },
  {
    id: 'green13',
    cardFace: MythicCardsURL + 'green/green13.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green14',
    cardFace: MythicCardsURL + 'green/green14.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green15',
    cardFace: MythicCardsURL + 'green/green15.png',
    difficulty: 'normal',
    color: 'green'
  },
  {
    id: 'green16',
    cardFace: MythicCardsURL + 'green/green16.png',
    difficulty: 'easy',
    color: 'green'
  },
  {
    id: 'green17',
    cardFace: MythicCardsURL + 'green/green17.png',
    difficulty: 'easy',
    color: 'green'
  },
  {
    id: 'green18',
    cardFace: MythicCardsURL + 'green/green18.png',
    difficulty: 'easy',
    color: 'green'
  },
]
// * ЗЕЛЕНЫЕ карты Мифов _end



// todo ЖЕЛТЫЕ карты Мифов _start

const yellowCards = [
  {
    id: 'yellow1',
    cardFace: MythicCardsURL + 'yellow/yellow1.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow2',
    cardFace: MythicCardsURL + 'yellow/yellow2.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow3',
    cardFace: MythicCardsURL + 'yellow/yellow3.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow4',
    cardFace: MythicCardsURL + 'yellow/yellow4.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow5',
    cardFace: MythicCardsURL + 'yellow/yellow5.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow6',
    cardFace: MythicCardsURL + 'yellow/yellow6.png',
    difficulty: 'hard',
    color: 'yellow'
  },
  {
    id: 'yellow7',
    cardFace: MythicCardsURL + 'yellow/yellow7.png',
    difficulty: 'hard',
    color: 'yellow'
  },
  {
    id: 'yellow8',
    cardFace: MythicCardsURL + 'yellow/yellow8.png',
    difficulty: 'hard',
    color: 'yellow'
  },
  {
    id: 'yellow9',
    cardFace: MythicCardsURL + 'yellow/yellow9.png',
    difficulty: 'hard',
    color: 'yellow'
  },
  {
    id: 'yellow10',
    cardFace: MythicCardsURL + 'yellow/yellow10.png',
    difficulty: 'hard',
    color: 'yellow'
  },
  {
    id: 'yellow11',
    cardFace: MythicCardsURL + 'yellow/yellow11.png',
    difficulty: 'easy',
    color: 'yellow'
  },
  {
    id: 'yellow12',
    cardFace: MythicCardsURL + 'yellow/yellow12.png',
    difficulty: 'easy',
    color: 'yellow'
  },
  {
    id: 'yellow13',
    cardFace: MythicCardsURL + 'yellow/yellow13.png',
    difficulty: 'easy',
    color: 'yellow'
  },
  {
    id: 'yellow14',
    cardFace: MythicCardsURL + 'yellow/yellow14.png',
    difficulty: 'easy',
    color: 'yellow'
  },
  {
    id: 'yellow15',
    cardFace: MythicCardsURL + 'yellow/yellow15.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow16',
    cardFace: MythicCardsURL + 'yellow/yellow16.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow17',
    cardFace: MythicCardsURL + 'yellow/yellow17.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow18',
    cardFace: MythicCardsURL + 'yellow/yellow18.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow19',
    cardFace: MythicCardsURL + 'yellow/yellow19.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow20',
    cardFace: MythicCardsURL + 'yellow/yellow20.png',
    difficulty: 'normal',
    color: 'yellow'
  },
  {
    id: 'yellow21',
    cardFace: MythicCardsURL + 'yellow/yellow21.png',
    difficulty: 'easy',
    color: 'yellow'
  },
]
// todo ЖЕЛТЫЕ карты Мифов _end



// ? СИНИЕ карты Мифов _start

const blueCards = [
  {
    id: 'blue1',
    cardFace: MythicCardsURL + 'blue/blue1.png',
    difficulty: 'hard',
    color: 'blue'
  },
  {
    id: 'blue2',
    cardFace: MythicCardsURL + 'blue/blue2.png',
    difficulty: 'hard',
    color: 'blue'
  },
  {
    id: 'blue3',
    cardFace: MythicCardsURL + 'blue/blue3.png',
    difficulty: 'easy',
    color: 'blue'
  },
  {
    id: 'blue4',
    cardFace: MythicCardsURL + 'blue/blue4.png',
    difficulty: 'easy',
    color: 'blue'
  },
  {
    id: 'blue5',
    cardFace: MythicCardsURL + 'blue/blue5.png',
    difficulty: 'easy',
    color: 'blue'
  },
  {
    id: 'blue6',
    cardFace: MythicCardsURL + 'blue/blue6.png',
    difficulty: 'hard',
    color: 'blue'
  },
  {
    id: 'blue7',
    cardFace: MythicCardsURL + 'blue/blue7.png',
    difficulty: 'normal',
    color: 'blue'
  },
  {
    id: 'blue8',
    cardFace: MythicCardsURL + 'blue/blue8.png',
    difficulty: 'hard',
    color: 'blue'
  },
  {
    id: 'blue9',
    cardFace: MythicCardsURL + 'blue/blue9.png',
    difficulty: 'normal',
    color: 'blue'
  },
  {
    id: 'blue10',
    cardFace: MythicCardsURL + 'blue/blue10.png',
    difficulty: 'easy',
    color: 'blue'
  },
  {
    id: 'blue11',
    cardFace: MythicCardsURL + 'blue/blue11.png',
    difficulty: 'normal',
    color: 'blue'
  },
  {
    id: 'blue12',
    cardFace: MythicCardsURL + 'blue/blue12.png',
    difficulty: 'normal',
    color: 'blue'
  },
]
// ? СИНИЕ карты Мифов _end
// ? карты Мифов _end

// ? КАРТЫ ДРЕВНИХ _start
// путь к картинкам древних
const ancientsURL = './src/img/assets/Ancients/';

const ancientsData = [
  {
    id: 'azathoth',
    name: 'azathoth',
    cardFace: ancientsURL + 'Azathoth' + '.png',
    firstStage: {
      greenCards: 1,
      blueCards: 1,
      yellowCards: 2,
    },
    secondStage: {
      greenCards: 2,
      blueCards: 1,
      yellowCards: 3,
    },
    thirdStage: {
      greenCards: 2,
      blueCards: 0,
      yellowCards: 4,
    },
  },
  {
    id: 'cthulhu',
    name: 'cthulhu',
    cardFace: ancientsURL + 'Cthulthu' + '.png',
    firstStage: {
      greenCards: 0,
      blueCards: 2,
      yellowCards: 2,
    },
    secondStage: {
      greenCards: 1,
      blueCards: 0,
      yellowCards: 3,
    },
    thirdStage: {
      greenCards: 3,
      blueCards: 0,
      yellowCards: 4,
    },
  },
  {
    id: 'iogSothoth',
    name: 'iogSothoth',
    cardFace: ancientsURL + 'IogSothoth' + '.png',
    firstStage: {
      greenCards: 0,
      blueCards: 1,
      yellowCards: 2,
    },
    secondStage: {
      greenCards: 2,
      blueCards: 1,
      yellowCards: 3,
    },
    thirdStage: {
      greenCards: 3,
      blueCards: 0,
      yellowCards: 4,
    },
  },
  {
    id: 'shubNiggurath',
    name: 'shubNiggurath',
    cardFace: ancientsURL + 'ShubNiggurath' + '.png',
    firstStage: {
      greenCards: 1,
      blueCards: 1,
      yellowCards: 2,
    },
    secondStage: {
      greenCards: 3,
      blueCards: 1,
      yellowCards: 2,
    },
    thirdStage: {
      greenCards: 2,
      blueCards: 0,
      yellowCards: 4,
    },
  },
]
// ? КАРТЫ ДРЕВНИХ _end

// ? Уровни сложности _start
const difficulties = [
  {
    id: 'veryEasy',
    name: 'veryEasy',
    description: `Очень легкий уровень сложности: 
    из набора берутся все карты со снежинками, 
    если карт не хватает то добираются обычные карты`,
  },
  {
    id: 'easy',
    name: 'easy',
    description: `Легкий уровень сложности:
    из набора убираются карты с щупальцами`,
  },
  {
    id: 'normal',
    name: 'normal',
    description: `Средний уровень сложности: 
    набор остается нетронутым`,
  },
  {
    id: 'hard',
    name: 'hard',
    description: `Высокий уровень сложности: 
    из набора убираются карты со снежинками`,
  },
  {
    id: 'veryHard',
    name: 'veryHard',
    description: `Очень высокий уровень сложности: 
    из набора берутся все карты со щупальцами, 
    если карт не хватает то добираются обычные карты`,
  },
]

// ? Уровни сложности _end


// ? массив фоновых картинок _start
let TEMP_BG = [];
let BG = [
  './src/img/bg/bg_1.jpg',
  './src/img/bg/bg_2.jpg',
  './src/img/bg/bg_3.jpg',
  './src/img/bg/bg_4.jpg',
  './src/img/bg/bg_5.jpg',
  './src/img/bg/bg_6.webp',
  './src/img/bg/bg_7.jpg',
  './src/img/bg/bg_8.jpg',
  './src/img/bg/bg_9.jpg',
  './src/img/bg/bg_10.jpg',
  './src/img/bg/bg_11.jpg',
  './src/img/bg/bg_12.jpg',
  './src/img/bg/bg_13.jpg',
  './src/img/bg/bg_14.webp',
  './src/img/bg/bg_15.jpg',
  './src/img/bg/bg_16.jpg',
]
// ? массив фоновых картинок _end


// ? массив рубашек карт _start
let TEMP_CARD_BG = [];
let CARD_BG = [
  './src/img/backCard/bc_1.webp',
  './src/img/backCard/bc_2.webp',
  './src/img/backCard/bc_3.webp',
  './src/img/backCard/bc_4.webp',
  './src/img/backCard/bc_5.webp',
  './src/img/backCard/bc_6.webp',
  './src/img/backCard/bc_7.webp',
  './src/img/backCard/bc_8.webp',
  './src/img/backCard/bc_9.webp',
  './src/img/backCard/bc_10.webp',
  './src/img/backCard/bc_11.webp',
  './src/img/backCard/bc_12.webp',
  './src/img/backCard/bc_13.png',
  './src/img/backCard/bc_14.webp',
  './src/img/backCard/bc_15.webp',
  './src/img/backCard/bc_16.webp',
];
// ? массив рубашек карт _end

//* ГЛОБ. ПЕРЕМЕННЫЕ _start

//* блоки страницы _start
// блок BODY
const BODY = document.querySelector('.body');

// блок для вывода картинок древних
const ANCIENTS_BLOCK = document.querySelector('.ancients');

// кнопки управления уровнем сложности блок
const BTS_DIFFICULTY = document.querySelector('.difficulty-list');

// блок с информацией стадии игры
const BLOCK_STAGES = document.querySelector('.stages');

// блок с картами
const BLOCK_CARDS = document.querySelector('.cards');


// этапы игры
// 1 этап 
const STAGE1_GREEN = document.querySelector('.stage1_green');
const STAGE1_YELLOW = document.querySelector('.stage1_yellow');
const STAGE1_BLUE = document.querySelector('.stage1_blue');

// 2 этап
const STAGE2_GREEN = document.querySelector('.stage2_green');
const STAGE2_YELLOW = document.querySelector('.stage2_yellow');
const STAGE2_BLUE = document.querySelector('.stage2_blue');

// 3 этап
const STAGE3_GREEN = document.querySelector('.stage3_green');
const STAGE3_YELLOW = document.querySelector('.stage3_yellow');
const STAGE3_BLUE = document.querySelector('.stage3_blue');


// ИЗОБРАЖЕНИЯ КАРТ _start
// <!-- блок для рубашки карты по ней выдаем карту -->
const BACK_CARD = document.querySelector('.back-card');
// картинка рубашки карты
// const BACK_CARD_IMG = document.querySelector('.back-card__img');

// <!-- блок для карты сюда вывести -->
const FACE_CARD = document.querySelector('.face-card');
// картинка рубашки карты
// const FACE_CARD_IMG = document.querySelector('.face-card__img');

// URL картинка РУБАШКИ КАРТЫ
const BACK_CARD_IMG_URL = 'src/img/assets/mythicCardBackground.png';

// кнопка сдать карты заново 
const BT_NEW_DECK = document.querySelector('.new-deck__bt');


//* блоки страницы _end

//* ГЛОБ ПЕРЕМ для игры _start
// выбран Древний:
let selectAncient = null;

// выбрана СЛОЖНОСТЬ игры:
let DIFFICULTY = null;

// МАССИВы ДЛЯ ЭТАПЫ ИГРЫ
// для каждого этапа формир массив из отобранных по условиям Древнего и Уровня сложности
// массивов цветов, берем из каждого то кол-во карт которое соотв древнему по его этапу и цвету
// ЭТАП 1/2/3
masSTAGE1 = [];
masSTAGE2 = [];
masSTAGE3 = [];

//* ГЛОБ ПЕРЕМ для игры _end

//* ГЛОБ. ПЕРЕМЕННЫЕ _end




// ЗАМЕШАТЬ МАССИВ ФОНОВЫХ КАРТИНОК при начальной загрузке страницы
shuffle(BG);

// ЗАМЕШАТЬ МАССИВ РУБАШЕК КАРТ при начальной загрузке страницы
shuffle(CARD_BG);

console.log(`МАССИВ РУБАШЕК КАРТ:`);
console.log(CARD_BG);

// дать новую фоновую картинку
function newBG() {
  // если массив фоновых картинок пуст то заполнить 
  if (!TEMP_BG.length) {
    for (let i = 0; i < BG.length; i++) {
      TEMP_BG.push(BG[i]);
      console.log(`ОБНОВИЛСЯ МАССИВ ФОНОВЫХ ИЗОБРАЖЕНИЙ`);
    }
  }
  // установить картинку на страницу
  BODY.style.backgroundImage = `url('${TEMP_BG.pop()}')`;
}

// установить фоновую картинку страницы при загрузке
newBG();


// дать новую рубашку карте
function newBackCard() {
  let card;
  // если массив фоновых картинок пуст то заполнить 
  if (!TEMP_CARD_BG.length) {
    for (let i = 0; i < CARD_BG.length; i++) {
      TEMP_CARD_BG.push(CARD_BG[i]);
      console.log(`ОБНОВИЛСЯ МАССИВ РУБАШЕК КАРТ ${i}`);

    }
  }

  // вернуть  картинку рубашки карты
  console.log(TEMP_CARD_BG);
  card = TEMP_CARD_BG.pop();
  console.log(card);
  return card;

}




//* СФОРМИРОВАТЬ КОЛОДУ КАРТ МИФОВ НА ОСНОВАНИИ ХАРАКТЕРИСТИК ДРЕВНЕГО И УРОВНЯ СЛОЖНОСТИ _start


// перемешать массив в случ порядке
// есть отличный алгоритм под названием Тасование Фишера — Йетса.
//  Суть заключается в том, чтобы проходить по массиву в обратном порядке
//   и менять местами каждый элемент со случайным элементом, который находится перед ним.
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1)); // случайный индекс от 0 до i

    let t = array[i];
    array[i] = array[j];
    array[j] = t;
    // поменять элементы местами
    // мы используем для этого синтаксис "деструктурирующее присваивание"
    // подробнее о нём - в следующих главах
    // то же самое можно записать как:
    // let t = array[i]; array[i] = array[j]; array[j] = t
    // [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}




// сформировать колоду карт ОДНОГО ЦВЕТА ДЛЯ ВСЕХ ЭТАПОВ
//  из массива карт опред цвета на основании выбранного уровня сложности
function createArrayOfCardsColor(arrayCardsColor) {
  let tempArray = [];
  let cardColor = arrayCardsColor[0].color + 'Cards';
  let countCards = 0;
  // узнать сколько всего карт этого цвета нужно для выбранного Древнего по всем этапам
  countCards = selectAncient.firstStage[cardColor] + selectAncient.secondStage[cardColor] + selectAncient.thirdStage[cardColor];
  // сколько карт не хватает - добрать карты
  let tempCount = countCards;

  console.log(`selectAncient:`);
  console.log(selectAncient);

  console.log(`selectAncient.firstStage[cardColor]:`);
  console.log(selectAncient.firstStage[cardColor]);


  console.log(`countCards = `);
  console.log(countCards);




  // перемешать в случ порядке полученный массив карт этого цвета 
  // для последущей работы массив будет содержать карты в случ порядке 
  console.log('первоначальный массив: ');
  console.log(arrayCardsColor);
  arrayCardsColor = shuffle(arrayCardsColor);
  console.log('Перемешанный массив: ');
  console.log(arrayCardsColor);

  switch (DIFFICULTY.id) {

    //? `Очень легкий уровень сложности: 
    //   из набора берутся все карты со снежинками, 
    //   если карт не хватает то добираются обычные карты`
    case 'veryEasy':
      console.log(`case 'veryEasy':`);
      for (let i = 0; i < arrayCardsColor.length; i++) {
        // если у карты совпадает ур сложности с easy и есть карты которые необходимо добрать tempCount
        if ((arrayCardsColor[i].difficulty === 'easy') && (tempCount)) {
          tempArray.push(arrayCardsColor[i]);
          tempCount--;
          // если набрали нужное кол-во карт т.е. tempCount == 0
          if (!tempCount) {
            break;
          }
        }
      }

      // проверить хватает ли отобранных карт?
      // если карт со снежинками т.е с уровнем easy не хватило то добавить обычные карты normal
      // можно и так if (tempCount) тогда ...
      if (tempArray.length < countCards) {
        //  сколько карт не хватает - добрать карты normal
        // tempCount = countCards - tempArray.length;
        for (let i = 0; i < arrayCardsColor.length; i++) {
          // если карта найдена с такой сложностью и кол-во карт для поиска еще не 0 тогда добавить в массив
          if ((arrayCardsColor[i].difficulty === 'normal') && (tempCount)) {
            tempArray.push(arrayCardsColor[i]);
            tempCount--;
            // если набрали нужное кол-во карт т.е. tempCount == 0 то выйти из цикла карты набраны
            if (!tempCount) {
              break;
            }
          }
        }
      }

      // проверяем теперь колода собрана или нет 
      // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
      if (tempArray.length !== countCards) {
        alert(`проверяем теперь колода собрана или нет 
  // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
  ВНИМАНИЕ! КАРТ НЕ ХВАТИЛО Уровень сложности veryEasy. карт не хватило: ${tempCount}`);
      }
      console.log(`tempArray `);
      console.log(tempArray);
      return tempArray;
      break;


    //? Легкий уровень сложности:
    // из набора убираются карты с щупальцами
    case 'easy':
      console.log(`case 'easy':`);
      for (let i = 0; i < arrayCardsColor.length; i++) {
        if (arrayCardsColor[i].difficulty !== 'hard') {
          tempArray.push(arrayCardsColor[i]);
          tempCount--;
          // если набрали нужное кол-во карт т.е. tempCount == 0 то выйти из цикла карты набраны
          if (!tempCount) {
            break;
          }
        }
      }

      // проверить хватает ли отобранных карт?
      // если карт не хватило то сообщить об этом - это ошибка!
      if (tempArray.length < countCards) {
        //  сколько карт не хватает - добрать карты normal
        tempCount = countCards - tempArray.length;
        console.log(`Для уровня easy не хватило ${tempCount} карт`);
      }

      // проверяем теперь колода собрана или нет 
      // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
      if (tempArray.length !== countCards) {
        alert(`проверяем теперь колода собрана или нет 
  // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
  ВНИМАНИЕ! КАРТ НЕ ХВАТИЛО Уровень сложности easy. карт не хватило: ${tempCount}`);
      }
      console.log(`tempArray `);
      console.log(tempArray);
      return tempArray;
      break;


    //? Средний уровень сложности: 
    // набор остается нетронутым
    case 'normal':
      console.log(`case 'normal':`);
      // набираем карты из тасованного массива без условий
      for (let i = 0; i < arrayCardsColor.length; i++) {
        tempArray.push(arrayCardsColor[i]);
        tempCount--;
        // если набрали нужное кол-во карт т.е. tempCount == 0 то выйти из цикла карты набраны
        if (!tempCount) {
          break;
        }
      }

      // проверить хватает ли отобранных карт?
      // если карт не хватило то сообщить об этом - это ошибка!
      if (tempArray.length < countCards) {
        //  сколько карт не хватает - добрать карты normal
        tempCount = countCards - tempArray.length;
        console.log(`Для уровня normal не хватило ${tempCount} карт`);
      }

      // проверяем теперь колода собрана или нет 
      // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
      if (tempArray.length !== countCards) {
        alert(`проверяем теперь колода собрана или нет 
  // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
  ВНИМАНИЕ! КАРТ НЕ ХВАТИЛО Уровень сложности normal. карт не хватило: ${tempCount}`);
      }
      console.log(`tempArray `);
      console.log(tempArray);
      return tempArray;
      break;


    //? Высокий уровень сложности: 
    // из набора убираются карты со снежинками т.е. easy
    case 'hard':
      console.log(`case 'hard':`);
      for (let i = 0; i < arrayCardsColor.length; i++) {
        if (arrayCardsColor[i].difficulty !== 'easy') {
          tempArray.push(arrayCardsColor[i]);
          tempCount--;
          // если набрали нужное кол-во карт т.е. tempCount == 0 то выйти из цикла карты набраны
          if (!tempCount) {
            break;
          }
        }
      }

      // проверить хватает ли отобранных карт?
      // если карт  не хватило то сообщить об этом. это ошибка!
      if (tempArray.length < countCards) {
        //  сколько карт не хватает 
        tempCount = countCards - tempArray.length;
        console.log(`Для уровня hard не хватило ${tempCount} карт`);
      }

      // проверяем теперь колода собрана или нет 
      // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
      if (tempArray.length !== countCards) {
        alert(`проверяем теперь колода собрана или нет 
  // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
  ВНИМАНИЕ! КАРТ НЕ ХВАТИЛО Уровень сложности hard. карт не хватило: ${tempCount}`);
      }
      console.log(`tempArray `);
      console.log(tempArray);
      return tempArray;

      break;


    //? Очень высокий уровень сложности: 
    // из набора берутся все карты со щупальцами, 
    // если карт не хватает то добираются обычные карты
    case 'veryHard':
      console.log(`case 'veryHard':`);
      for (let i = 0; i < arrayCardsColor.length; i++) {
        // если у карты совпадает ур сложности с hard и есть карты которые необходимо добрать tempCount
        if ((arrayCardsColor[i].difficulty === 'hard') && (tempCount)) {
          tempArray.push(arrayCardsColor[i]);
          tempCount--;
          // если набрали нужное кол-во карт т.е. tempCount == 0
          if (!tempCount) {
            break;
          }
        }
      }

      // проверить хватает ли отобранных карт?
      // если карт со щупальцами т.е с уровнем hard не хватило то добавить обычные карты normal
      // можно и так if (tempCount) тогда ...
      if (tempArray.length < countCards) {
        //  сколько карт не хватает - добрать карты normal
        // tempCount = countCards - tempArray.length;
        for (let i = 0; i < arrayCardsColor.length; i++) {
          // если карта найдена с такой сложностью и кол-во карт для поиска еще не 0 тогда добавить в массив
          if ((arrayCardsColor[i].difficulty === 'normal') && (tempCount)) {
            tempArray.push(arrayCardsColor[i]);
            tempCount--;
            // если набрали нужное кол-во карт т.е. tempCount == 0 то выйти из цикла карты набраны
            if (!tempCount) {
              break;
            }
          }
        }
      }

      // проверяем теперь колода собрана или нет 
      // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
      if (tempArray.length !== countCards) {
        alert(`проверяем теперь колода собрана или нет 
  // т.е. кол-во карт у древнего должно быть равно кол-ву карт нашего массива
  ВНИМАНИЕ! КАРТ НЕ ХВАТИЛО Уровень сложности veryHard. карт не хватило: ${tempCount}`);
      }
      console.log(`tempArray `);
      console.log(tempArray);
      return tempArray;
      break;


    default: alert(`Ошибка! Не удалось определить уровень сложности
  при формировании колоды. Цвет колоды: ${arrayCardsColor[0].color}`);
      console.log(`Ошибка! Не удалось определить уровень сложности
  при формировании колоды. Цвет колоды: ${arrayCardsColor[0].color}`);
      break;
  }
}


// формирование колод для Этапов
function createColorArray() {


  // сформировать колоду карт ОДНОГО ЦВЕТА ДЛЯ ВСЕХ ЭТАПОВ
  //  из массива карт опред цвета на основании выбранного уровня сложности
  // получить перемешанные массивы карт выбранного цвета в зависимости от условий Древнего и уровня сложности
  let greenArray = createArrayOfCardsColor(greenCards);
  let yellowArray = createArrayOfCardsColor(yellowCards);
  let blueArray = createArrayOfCardsColor(blueCards);

  console.log(`greenArray: `);
  console.log(greenArray);
  console.log(`yellowArray: `);
  console.log(yellowArray);
  console.log(`blueArray: `);
  console.log(blueArray);


  // формирование колод для Этапов
  // сформировать колоду для указанного этапа из переданных массивов цвета
  // в процессе из массива цвета удаляется элемент т.е. карта и заносится в массив этапа
  // и так для каждого массива цвета.
  // к 3 этапу в массивах цвета не должно оставаться ни одного элемента (карты)
  masSTAGE1 = getStageArray('firstStage', greenArray, yellowArray, blueArray);
  console.log(`masSTAGE1  МАССИВ ЭТАП1: `);
  console.log(masSTAGE1);
  // перемешать массив этапа 1
  masSTAGE1 = shuffle(masSTAGE1);

  masSTAGE2 = getStageArray('secondStage', greenArray, yellowArray, blueArray);
  console.log(`masSTAGE2  МАССИВ ЭТАП2: `);
  console.log(masSTAGE2);
  // перемешать массив этапа 2
  masSTAGE2 = shuffle(masSTAGE2);

  masSTAGE3 = getStageArray('thirdStage', greenArray, yellowArray, blueArray);
  console.log(`masSTAGE3  МАССИВ ЭТАП3: `);
  console.log(masSTAGE3);
  // перемешать массив этапа 3
  masSTAGE3 = shuffle(masSTAGE3);

  console.log(`ЭТАПЫ СФОРМИРОВАНЫ. массивы цвета должны быть пусты: `);
  console.log(`greenArray: `);
  console.log(greenArray);
  console.log(`yellowArray: `);
  console.log(yellowArray);
  console.log(`blueArray: `);
  console.log(blueArray);

  // Обновить показатели ЭТАПОВ на странице
  updateScores();


}


// сформировать колоду для указанного этапа из переданных массивов цвета
// в процессе из массива цвета удаляется элемент т.е. карта и заносится в массив этапа
// и так для каждого массива цвета.
// к 3 этапу в массивах цвета не должно оставаться ни одного элемента (карты) 
function getStageArray(stage, greenArray, yellowArray, blueArray) {
  let tempArray = [];

  // ЗЕЛЕНЫЙ ЦВЕТ
  for (let i = 0; i < selectAncient[stage].greenCards; i++) {
    tempArray.push(greenArray.pop());
  }
  // ЖЕЛТЫЙ ЦВЕТ
  for (let i = 0; i < selectAncient[stage].yellowCards; i++) {
    tempArray.push(yellowArray.pop());
  }
  // СИНИЙ ЦВЕТ
  for (let i = 0; i < selectAncient[stage].blueCards; i++) {
    tempArray.push(blueArray.pop());
  }

  return tempArray;
}


// Обновить показатели ЭТАПОВ на странице
function updateScores() {
  let countGreen = 0;
  let countYellow = 0;
  let countBlue = 0;

  // ЭТАП 1
  for (let i = 0; i < masSTAGE1.length; i++) {
    switch (masSTAGE1[i].color) {
      case 'green': countGreen++;
        break;
      case 'yellow': countYellow++;
        break;
      case 'blue': countBlue++;
        break;
    }
  }
  STAGE1_GREEN.textContent = countGreen;
  STAGE1_YELLOW.textContent = countYellow;
  STAGE1_BLUE.textContent = countBlue;

  // если в этапе закончились карты  
  // то сделать блок на странице тусклым
  if ((!countGreen) && (!countYellow) && (!countBlue)) {
    if (!STAGE1_GREEN.classList.contains('opacity-block')) {
      STAGE1_GREEN.classList.add('opacity-block');
    }
    if (!STAGE1_YELLOW.classList.contains('opacity-block')) {
      STAGE1_YELLOW.classList.add('opacity-block');
    }
    if (!STAGE1_BLUE.classList.contains('opacity-block')) {
      STAGE1_BLUE.classList.add('opacity-block');
    }
  }


  // обнулить счетчики для след этапа
  countGreen = 0;
  countYellow = 0;
  countBlue = 0;

  // ЭТАП 2
  for (let i = 0; i < masSTAGE2.length; i++) {
    switch (masSTAGE2[i].color) {
      case 'green': countGreen++;
        break;
      case 'yellow': countYellow++;
        break;
      case 'blue': countBlue++;
        break;
    }
  }
  STAGE2_GREEN.textContent = countGreen;
  STAGE2_YELLOW.textContent = countYellow;
  STAGE2_BLUE.textContent = countBlue;

  // если в этапе закончились карты  
  // то сделать блок на странице тусклым
  if ((!countGreen) && (!countYellow) && (!countBlue)) {
    if (!STAGE2_GREEN.classList.contains('opacity-block')) {
      STAGE2_GREEN.classList.add('opacity-block');
    }
    if (!STAGE2_YELLOW.classList.contains('opacity-block')) {
      STAGE2_YELLOW.classList.add('opacity-block');
    }
    if (!STAGE2_BLUE.classList.contains('opacity-block')) {
      STAGE2_BLUE.classList.add('opacity-block');
    }
  }

  // обнулить счетчики для след этапа
  countGreen = 0;
  countYellow = 0;
  countBlue = 0;

  // ЭТАП 3
  for (let i = 0; i < masSTAGE3.length; i++) {
    switch (masSTAGE3[i].color) {
      case 'green': countGreen++;
        break;
      case 'yellow': countYellow++;
        break;
      case 'blue': countBlue++;
        break;
    }
  }
  STAGE3_GREEN.textContent = countGreen;
  STAGE3_YELLOW.textContent = countYellow;
  STAGE3_BLUE.textContent = countBlue;

  // если в этапе закончились карты  
  // то сделать блок на странице тусклым
  // если в третьем этапе закончились карты 
  // значит карт нет в колоде - нужно убрать рубашку карты со страницы
  if ((!countGreen) && (!countYellow) && (!countBlue)) {
    if (!STAGE3_GREEN.classList.contains('opacity-block')) {
      STAGE3_GREEN.classList.add('opacity-block');
    }
    if (!STAGE3_YELLOW.classList.contains('opacity-block')) {
      STAGE3_YELLOW.classList.add('opacity-block');
    }
    if (!STAGE3_BLUE.classList.contains('opacity-block')) {
      STAGE3_BLUE.classList.add('opacity-block');
    }

    // если в третьем этапе закончились карты 
    // значит карт нет в колоде - нужно убрать рубашку карты со страницы
    unSetCard(BACK_CARD);
  }



}


// ВЫДАТЬ КАРТУ 
function getCard() {
  // если массив колоды Этапа 1 не пуст то выдать карту
  if (masSTAGE1.length) {
    return masSTAGE1.pop();
  }

  if (masSTAGE2.length) {
    return masSTAGE2.pop();
  }

  if (masSTAGE3.length) {
    return masSTAGE3.pop();
  }

  // если массивы пусты - значит все карты выданы
  // нужно убрать рубашку карты со страницы
  return null;

}

// вывести рубашку карты  или карту на страницу
function setCard(block, url) {
  // block.setAttribute('src', url);
  block.style.backgroundImage = `url('${url}')`;
}

// убрать рубашку или карту со страницы
function unSetCard(block) {
  // block.setAttribute('src', '');
  block.style.removeProperty('background-image');
}

function nextCard() {
  // получить очередную карту
  let card = getCard();

  // если карты кончились тогда 
  // + убрать рубашку карты со страницы
  // + и убрать выведенную карту со страницы
  // + обновить показатели этапов
  if (!card) {
    // + убрать рубашку карты со страницы
    // unSetCard(BACK_CARD_IMG);
    unSetCard(BACK_CARD);
    // + и убрать выведенную карту со страницы
    // unSetCard(FACE_CARD_IMG);
    unSetCard(FACE_CARD);
    // + обновить показатели этапов
    updateScores();

    // сделать блок карт неактивным
    BLOCK_CARDS.classList.add('inactive-block');

  }
  // если карта есть то 
  // установить карту на страницу
  // обновить показатели этапов
  else {
    // установить карту на страницу
    // setCard(FACE_CARD_IMG, card.cardFace);
    setCard(FACE_CARD, card.cardFace);
    // обновить показатели этапов
    updateScores();



  }
}


// ЗАМЕШАТЬ КОЛОДУ ЗАНОВО
// поменять фон страницы
// поменять рубашку карт
// убрать карту из выданных карт
function newDeck() {
  // замешать колоды карт по цветам 
  createColorArray();
  console.log(`КОЛОДЫ по цветам ГОТОВЫ`);
  // поменять фон страницы
  newBG();
  // установить рубашку карт
  setCard(BACK_CARD, newBackCard());
  // убрать карту из выданных карт
  unSetCard(FACE_CARD);
  // ЗАДАТЬ начальные параметры стилей перед началом новой игры
  initialCSSstages();
  // сделать блок карт активным
  BLOCK_CARDS.classList.remove('inactive-block');
}


// ЗАДАТЬ начальные параметры стилей Этапов перед началом новой игры
function initialCSSstages() {

  // убрать затеменение с блоков кол-ва карт этапов
  if (STAGE1_GREEN.classList.contains('opacity-block')) {
    STAGE1_GREEN.classList.remove('opacity-block');
  }
  if (STAGE1_YELLOW.classList.contains('opacity-block')) {
    STAGE1_YELLOW.classList.remove('opacity-block');
  }
  if (STAGE1_BLUE.classList.contains('opacity-block')) {
    STAGE1_BLUE.classList.remove('opacity-block');
  }
  if (STAGE2_GREEN.classList.contains('opacity-block')) {
    STAGE2_GREEN.classList.remove('opacity-block');
  }
  if (STAGE2_YELLOW.classList.contains('opacity-block')) {
    STAGE2_YELLOW.classList.remove('opacity-block');
  }
  if (STAGE2_BLUE.classList.contains('opacity-block')) {
    STAGE2_BLUE.classList.remove('opacity-block');
  }
  if (STAGE3_GREEN.classList.contains('opacity-block')) {
    STAGE3_GREEN.classList.remove('opacity-block');
  }
  if (STAGE3_YELLOW.classList.contains('opacity-block')) {
    STAGE3_YELLOW.classList.remove('opacity-block');
  }
  if (STAGE3_BLUE.classList.contains('opacity-block')) {
    STAGE3_BLUE.classList.remove('opacity-block');
  }


}

//* СФОРМИРОВАТЬ КОЛОДУ КАРТ МИФОВ НА ОСНОВАНИИ ХАРАКТЕРИСТИК ДРЕВНЕГО И УРОВНЯ СЛОЖНОСТИ _end








//* РАСПОЛОЖЕНИЕ ЭЛЕМЕНТОВ НА СТРАНИЦЕ И ДЕЙСТВИЯ НАД НИМИ _START

// вывод  картинок древних  _start
function insertImgAncients() {
  for (let i = 0; i < ancientsData.length; i++) {
    // создать блок DIV для картинки
    let div = document.createElement('div');
    // задать класс блоку
    div.classList.add('ancients__item');
    // задать id блоку div для идентификации при клике
    div.setAttribute('id', ancientsData[i].id);
    // создать изображение
    let img = document.createElement('img');
    // указать путь к изображению
    img.setAttribute('src', ancientsData[i].cardFace);
    // задать класс изображению
    img.classList.add('ancients__item__img');
    // вставить изображение в блок div
    div.append(img);
    // вставить блок div с изображением img в блок для всех древних
    ANCIENTS_BLOCK.append(div);

    // назаначить обработчик при клике
    div.addEventListener('click', choiceAncients);

  }


}


// * вывод  картинок древних на страницу
insertImgAncients();
// вывод картинок Древних на страницу _end


//? ВЫБОР КАРТЫ ДРЕВНЕГО _start
// Выбрали Древнего
function choiceAncients() {
  selectAncient = 0;
  // поиск выбранного древненго в массиве
  for (let i = 0; i < ancientsData.length; i++) {
    if (ancientsData[i].id === this.id) {
      selectAncient = ancientsData[i];
      console.log(selectAncient);
      break;
    }
  }

  if (!selectAncient) {
    alert(`Ошибка, Древний не найден.`);
  }

  //выделить карту на странице добавить класс для выбранного элемента
  document.querySelectorAll('.ancients__item').forEach(element => {
    element.classList.remove('ancients__item-active');
  });
  this.classList.add('ancients__item-active');

  console.log('Выбрали Древнего ' + selectAncient);


  // если игра уже идет т.е. есть настройка Сложности игры
  //  и в процессе поменяли древнего то
  // необходимо заново сдать карты под нового Древнего и уже выбранную настройку сложности
  if (DIFFICULTY) {
    // ЗАМЕШАТЬ КОЛОДУ ЗАНОВО
    // поменять фон страницы
    // поменять рубашку карт
    // убрать карту из выданных карт
    newDeck();
  }


  // при загрузке страницы кнопки с уровнями сложности скрыты
  // когда выбрали древнего тогда показать кнопки 
  if (selectAncient) {
    if (BTS_DIFFICULTY.classList.contains('hide-block')) {
      BTS_DIFFICULTY.classList.remove('hide-block');
    }
  }
}
//? ВЫБОР КАРТЫ ДРЕВНЕГО _end





//? ВЫБОР УРОВНЯ СЛОЖНОСТИ _start
// назначить кнопкам сложности обработчик
function selectDifficulty() {

  // поиск выбранного уровня сложности в массиве
  for (let i = 0; i < difficulties.length; i++) {
    if (difficulties[i].id === this.id) {
      DIFFICULTY = difficulties[i];
      console.log(DIFFICULTY);
      break;
    }
  }

  if (!DIFFICULTY) {
    alert(`Ошибка. Уровень сложности не найден.`);
  }

  //выделить кнопку на странице добавить класс для выбранного элемента
  document.querySelectorAll('.bt-difficulty').forEach(element => {
    element.classList.remove('bt-active');
  });
  this.classList.add('bt-active');

  console.log('Выбраны сложность игры: ' + DIFFICULTY.name);
  console.log(DIFFICULTY.description);


  // ЗАМЕШАТЬ КОЛОДУ ЗАНОВО
  // поменять фон страницы
  // поменять рубашку карт
  // убрать карту из выданных карт
  // замешать колоды карт по цветам 
  createColorArray();
  console.log(`КОЛОДЫ по цветам ГОТОВЫ`);

  // установить рубашку карт
  setCard(BACK_CARD, newBackCard());
  // убрать карту из выданных карт
  unSetCard(FACE_CARD);
  // сделать блок карт активным
  BLOCK_CARDS.classList.remove('inactive-block');


  // при загрузке страницы кнопки с уровнями сложности скрыты
  // когда выбрали древнего тогда показали кнопки
  // при выборе кнопки - выбран уровень сложности
  // можно показать блоки с этапами игры и карты 
  if (DIFFICULTY) {
    if (BLOCK_STAGES.classList.contains('hide-block')) {
      BLOCK_STAGES.classList.remove('hide-block');
    }
    if (BLOCK_CARDS.classList.contains('hide-block')) {
      BLOCK_CARDS.classList.remove('hide-block');
    }
  }


}

// назначить кнопкам сложности обработчик
document.querySelectorAll('.bt-difficulty').forEach(element => {
  element.addEventListener('click', selectDifficulty);
});
//? ВЫБОР УРОВНЯ СЛОЖНОСТИ _end




// ВЫДАТЬ КАРТУ ИЗ КОЛОДЫ _start
BACK_CARD.addEventListener('click', nextCard);


// кнопка сдать карты заново
BT_NEW_DECK.addEventListener('click', newDeck);









//* РАСПОЛОЖЕНИЕ ЭЛЕМЕНТОВ НА СТРАНИЦЕ И ДЕЙСТВИЯ НАД НИМИ _END






